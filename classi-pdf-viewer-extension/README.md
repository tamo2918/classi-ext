# Classi PDF Viewer - Chrome拡張機能

ClassiのPDFをダウンロードせずに、同じタブ内のオーバーレイで直接表示するChrome拡張機能です。

## 機能

- **オーバーレイ表示**: PDFリンクをクリックすると、同じタブ内にモーダルウィンドウでPDFが表示されます
- **タブの切り替え不要**: 別タブに移動せず、Classiのページに留まったままPDFを閲覧できます
- **簡単に閉じられる**: 右上のバツボタン、ESCキー、背景クリックで閉じられます
- **ダウンロードフォルダが散らからない**: 自動ダウンロードされません
- **必要なときだけダウンロード**: PDFビューアの保存ボタンから必要に応じてダウンロード可能

## 動作原理

この拡張機能は2つの技術を組み合わせています：

### 1. Content Script（オーバーレイ表示）
- PDFリンクのクリックを傍受
- デフォルトの動作（新しいタブで開く）をキャンセル
- 同じページ内にモーダルウィンドウを表示
- iframeでPDFを埋め込み表示

### 2. declarativeNetRequest（ヘッダー書き換え）
- PDFのレスポンスヘッダーを自動的に書き換え
- **変更前**: `Content-Disposition: attachment` (強制ダウンロード)
- **変更後**: `Content-Disposition: inline` (ブラウザ内表示可能)

## インストール方法

### 1. 拡張機能フォルダの準備

このフォルダ全体を任意の場所に保存します。

### 2. Chromeで拡張機能を読み込む

1. Google Chromeを開きます
2. アドレスバーに `chrome://extensions/` と入力してEnterキーを押します
3. 右上の「デベロッパーモード」をONにします
4. 「パッケージ化されていない拡張機能を読み込む」ボタンをクリックします
5. この `classi-pdf-viewer-extension` フォルダを選択します

### 3. 動作確認

1. [Classi](https://platform.classi.jp/)にログインします
2. 校内グループなどでPDFが添付された投稿を開きます
3. PDFリンクをクリックします
4. **同じタブ内にモーダルウィンドウが表示され、PDFが閲覧できることを確認します**
5. バツボタンまたはESCキーで閉じられることを確認します

## 必要な権限

- `declarativeNetRequest`: レスポンスヘッダーを書き換えるために必要です
- `https://platform.classi.jp/*`: Classiサイトでのみ動作するように制限されています

## ファイル構成

```
classi-pdf-viewer-extension/
├── manifest.json       # 拡張機能の設定ファイル
├── content.js          # PDFリンクの傍受とオーバーレイ表示
├── styles.css          # オーバーレイのスタイル
├── rules.json          # ヘッダー書き換えルール
├── icon16.png          # 16x16アイコン
├── icon48.png          # 48x48アイコン
├── icon128.png         # 128x128アイコン
└── README.md           # このファイル
```

## 使い方のヒント

### PDFを閉じる方法
- **バツボタン**: 右上の×ボタンをクリック
- **ESCキー**: キーボードのESCキーを押す
- **背景クリック**: モーダルの外側（暗い背景部分）をクリック

### PDFを保存する方法
- モーダル内のPDFビューアの保存ボタン（印刷アイコン）からダウンロードできます

## トラブルシューティング

### PDFがモーダルで表示されない場合

1. 拡張機能が有効になっているか確認してください（`chrome://extensions/`）
2. ページをリロード（F5またはCmd+R）してから再度PDFリンクをクリックしてください
3. 拡張機能を一度無効化→有効化してみてください
4. Chromeブラウザを再起動してください

### PDFがまだダウンロードされる場合

1. Content Scriptが正しく読み込まれているか確認
2. ブラウザコンソール（F12）でエラーがないか確認
3. 拡張機能をアンインストールして再インストール

### オーバーレイが表示されたままの場合

- ESCキーを押すか、ページをリロードしてください

### その他の問題

拡張機能のエラーログを確認するには:
1. `chrome://extensions/` を開く
2. この拡張機能の「エラー」ボタンをクリック
3. エラーメッセージを確認
4. ブラウザのコンソール（F12 → Console）でもエラーを確認できます

## 技術情報

- **Manifest Version**: 3
- **主要API**:
  - `declarativeNetRequest` (ヘッダー書き換え)
  - Content Scripts (DOM操作とイベント傍受)
- **対象URL**: `https://platform.classi.jp/api/cbank/*/download/pdf`
- **Chrome最小バージョン**: 128+ (responseHeaders修正のため)
- **レスポンシブ対応**: デスクトップ、タブレット、モバイル

## ライセンス

MIT License

## 作成者

このChrome拡張機能は、Classiユーザーの利便性向上のために作成されました。
